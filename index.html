<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>우종서</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/hanzi-writer@3.5/dist/hanzi-writer.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&amp;family=Noto+Sans+KR:wght@400;500&amp;display=swap" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&amp;family=Noto+Sans+KR:wght@400;500&amp;display=swap');
        
        html, body {
            height: 100vh;
            overflow: hidden;
            font-family: 'Noto Sans KR', system-ui, sans-serif;
        }
        .hanzi-font {
            font-family: 'Noto Serif SC', serif;
        }
        .vertical-rl {
            writing-mode: vertical-rl;
            text-orientation: mixed;
        }
        .writer-wrapper {
            background: #ffffff;
            border-radius: 2.5rem;
            padding: 1.5rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.05);
            border: 1px solid #e6d9c2;
        }
        .paper-bg {
            background: #f8f4eb;
        }
        .stage-title {
            font-size: 6.5rem;
            line-height: 0.85;
            font-weight: 700;
            color: #1e40af;
            letter-spacing: -0.04em;
        }
        .word-pill {
            writing-mode: vertical-rl;
            text-orientation: mixed;
        }
    </style>
</head>
<body class="paper-bg text-[#111827] flex flex-col">
    <!-- 상단 미니 헤더 -->
    <div class="h-14 border-b border-[#e6d9c2] bg-white flex items-center px-6 text-sm">
        <div class="flex items-center gap-3">
            <div class="w-7 h-7 bg-[#1e40af] text-white rounded-xl flex items-center justify-center text-xl leading-none hanzi-font">文</div>
            <span class="font-bold tracking-tighter text-xl hanzi-font text-[#1e40af]">우종서</span>
        </div>
        
        <div class="flex-1 max-w-md mx-auto">
            <input id="input-text" type="text" 
                class="w-full bg-transparent border-b border-[#d1c4a8] focus:border-[#1e40af] py-2 px-4 text-lg outline-none text-center hanzi-font placeholder:text-[#9c8a6e]"
                placeholder="甘言利說 學習 漢字"
                onkeyup="if(event.key==='Enter') loadWords()">
        </div>
    </div>

    <div class="flex flex-1 overflow-hidden">
        <!-- 좌측: 세로 단계 표시 (우종서 느낌) -->
        <div onclick="toggleStage()" 
             class="w-24 bg-white border-r border-[#e6d9c2] flex flex-col items-center justify-center cursor-pointer hover:bg-[#f8f4eb] transition-colors">
            <div id="stage-title" class="stage-title vertical-rl text-center h-96"></div>
            <div id="stage-dot" class="mt-8 w-3 h-3 bg-[#1e40af] rounded-full"></div>
        </div>

        <!-- 중앙: 학습 영역 (완전 중앙 집중, 여백 최대) -->
        <div class="flex-1 flex flex-col items-center justify-center p-8 overflow-hidden" id="main-area" onclick="toggleStage()">
            <div id="char-container" class="flex flex-col items-center gap-16 max-h-[85vh] overflow-y-auto py-8"></div>
        </div>

        <!-- 우측: 단어 선택 (세로 스크롤 최소) -->
        <div class="w-28 bg-white border-l border-[#e6d9c2] overflow-y-auto py-6 flex flex-col items-center gap-8">
            <div id="word-list" class="flex flex-col gap-10"></div>
        </div>
    </div>

    <script>
        let words = [];
        let currentWordIdx = 0;
        let currentStage = 0; // 0: 획순, 1: 퀴즈
        let writers = [];
        let currentWord = "";
        let animationTimer = null;
        let isQuizzing = false;

        function initTailwind() {
            tailwind.config = { content: [] };
        }

        function loadWords() {
            const text = document.getElementById('input-text').value.trim();
            if (!text) return;
            words = text.split(/\s+/).filter(w => w.length);
            if (words.length) {
                currentWordIdx = 0;
                loadCurrentWord();
            }
        }

        function renderWordList() {
            const container = document.getElementById('word-list');
            container.innerHTML = '';
            words.forEach((word, i) => {
                const div = document.createElement('div');
                div.className = `word-pill px-4 py-6 text-3xl hanzi-font cursor-pointer transition-all rounded-3xl border ${i === currentWordIdx ? 'bg-[#1e40af] text-white border-[#1e40af] shadow-md' : 'bg-white hover:bg-[#f8f4eb] border-[#e6d9c2]'}`;
                div.textContent = word;
                div.onclick = (e) => {
                    e.stopImmediatePropagation();
                    currentWordIdx = i;
                    loadCurrentWord();
                };
                container.appendChild(div);
            });
        }

        function loadCurrentWord() {
            currentWord = words[currentWordIdx] || '';
            renderWordList();

            writers = [];
            const container = document.getElementById('char-container');
            container.innerHTML = '';

            const chars = Array.from(currentWord).map(ch => ch.normalize('NFKC'));

            chars.forEach(ch => {
                const wrapper = document.createElement('div');
                wrapper.className = 'writer-wrapper';
                const canvas = document.createElement('div');
                canvas.style.width = '260px';
                canvas.style.height = '260px';
                wrapper.appendChild(canvas);
                container.appendChild(wrapper);

                try {
                    const writer = HanziWriter.create(canvas, ch, {
                        width: 240,
                        height: 240,
                        padding: 25,
                        strokeColor: '#1e40af',
                        radicalColor: '#334155',
                        outlineColor: '#e6d9c2',
                        drawingColor: '#3b82f6',
                        strokeAnimationSpeed: 1.2,
                        delayBetweenStrokes: 80,
                        showOutline: true,
                        showCharacter: true
                    });
                    writers.push(writer);
                } catch(e) {}
            });

            enterStage();
        }

        function enterStage() {
            clearInterval(animationTimer);
            writers.forEach(w => { if(w) { w.pauseAnimation(); w.cancelQuiz(); } });
            isQuizzing = false;

            document.getElementById('stage-title').innerHTML = currentStage === 0 ? '筆<br>順' : '練<br>習';

            if (currentStage === 0) {
                // 획순 모드 - 즉시 자동 무한 재생
                writers.forEach(w => { if(w) w.showCharacter(); });
                startInfiniteAnimation();
            } else {
                // 퀴즈 모드 - 즉시 시작
                startQuizMode();
            }
        }

        function startInfiniteAnimation() {
            let idx = 0;
            const loop = () => {
                if (idx >= writers.length) {
                    animationTimer = setTimeout(() => { idx = 0; loop(); }, 1400);
                    return;
                }
                const w = writers[idx];
                if (w) {
                    w.animateCharacter({
                        strokeAnimationSpeed: 5.5,
                        onComplete: () => { idx++; loop(); }
                    });
                } else {
                    idx++; loop();
                }
            };
            loop();
        }

        function startQuizMode() {
            isQuizzing = true;
            let charIdx = 0;

            const nextCharQuiz = () => {
                if (charIdx >= writers.length) {
                    // 단어 전체 완료 → 획순 모드로 자동 복귀
                    currentStage = 0;
                    enterStage();
                    return;
                }

                const w = writers[charIdx];
                if (!w) { charIdx++; nextCharQuiz(); return; }

                w.hideCharacter();
                w.showOutline();

                let strokeCount = 0;

                w.quiz({
                    leniency: 0.85,
                    showHintAfterMisses: 1,
                    onCorrectStroke: (data) => {
                        strokeCount++;
                        if (strokeCount === 1) {
                            // 한 획만 맞추면 즉시 종료하고 애니메이션으로 복귀
                            w.cancelQuiz();
                            w.showCharacter();
                            w.animateCharacter({
                                strokeAnimationSpeed: 1.8,
                                onComplete: () => {
                                    charIdx++;
                                    setTimeout(nextCharQuiz, 800);
                                }
                            });
                        }
                    },
                    onComplete: () => {
                        // 안전장치: 전체 완성 시에도 다음으로
                        w.showCharacter();
                        charIdx++;
                        setTimeout(nextCharQuiz, 600);
                    }
                });
            };

            nextCharQuiz();
        }

        function toggleStage() {
            currentStage = 1 - currentStage;
            enterStage();
        }

        // 모바일 터치 지원
        let touchStartX = 0;
        document.addEventListener('touchstart', e => { touchStartX = e.changedTouches[0].screenX; });
        document.addEventListener('touchend', e => {
            const diff = touchStartX - e.changedTouches[0].screenX;
            if (Math.abs(diff) > 80) {
                if (diff > 0 && currentWordIdx < words.length - 1) {
                    currentWordIdx++;
                    loadCurrentWord();
                } else if (diff < 0 && currentWordIdx > 0) {
                    currentWordIdx--;
                    loadCurrentWord();
                }
            }
        });

        // 키보드
        document.addEventListener('keydown', e => {
            if (e.key === 'ArrowRight' || e.key === ' ') toggleStage();
            if (e.key === 'ArrowDown' && currentWordIdx < words.length - 1) {
                currentWordIdx++; loadCurrentWord();
            }
            if (e.key === 'ArrowUp' && currentWordIdx > 0) {
                currentWordIdx--; loadCurrentWord();
            }
        });

        window.onload = () => {
            initTailwind();
            document.getElementById('input-text').value = "甘言利說 學習 漢字 你好 世界";
            loadWords();
            
            // 반응형 여백 조정
            setTimeout(() => {
                document.getElementById('main-area').classList.add('scale-[0.98]');
            }, 300);
        };
    </script>
</body>
</html>
