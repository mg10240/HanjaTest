<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•œì ìš°ì¢…ì„œ â€” ì„¸ë¡œ í•™ìŠµê¸°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/hanzi-writer@3.5/dist/hanzi-writer.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&amp;family=Noto+Sans+KR:wght@400;500&amp;display=swap" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&amp;family=Noto+Sans+KR:wght@400;500&amp;display=swap');
        
        body {
            font-family: 'Noto Sans KR', system-ui, sans-serif;
        }
        .hanzi-font {
            font-family: 'Noto Serif SC', serif;
        }
        .vertical-rl {
            writing-mode: vertical-rl;
            text-orientation: mixed;
        }
        .char-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
        }
        .writer-wrapper {
            background: #111827;
            border-radius: 1.5rem;
            padding: 1rem;
            box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.4);
        }
        .stage-title {
            font-size: 3.5rem;
            line-height: 1;
            font-weight: 700;
            color: #f43f5e;
            letter-spacing: 0.15em;
        }
        .tail-container {
            max-width: 1280px;
            margin: 0 auto;
        }
    </style>
</head>
<body class="bg-zinc-950 text-zinc-100 min-h-screen">
    <div class="flex h-screen">
        <!-- ì‚¬ì´ë“œë°” -->
        <div class="w-80 bg-zinc-900 border-r border-zinc-800 flex flex-col">
            <div class="p-8 border-b border-zinc-800">
                <div class="flex items-center gap-3">
                    <div class="w-9 h-9 bg-rose-500 rounded-2xl flex items-center justify-center text-2xl">æ–‡</div>
                    <h1 class="text-3xl font-bold tracking-tighter hanzi-font">ìš°ì¢…ì„œ</h1>
                </div>
                <p class="text-zinc-400 text-sm mt-1">í•œì ë‹¨ì–´ ì„¸ë¡œ í•™ìŠµê¸°</p>
            </div>

            <!-- ì…ë ¥ -->
            <div class="p-8 flex-1 overflow-auto">
                <label class="block text-sm font-medium text-zinc-400 mb-2">í•™ìŠµí•  í…ìŠ¤íŠ¸ (ë„ì–´ì“°ê¸°ë¡œ ë‹¨ì–´ êµ¬ë¶„)</label>
                <textarea id="input-text" rows="4" 
                    class="w-full bg-zinc-800 border border-zinc-700 rounded-3xl px-5 py-4 text-lg resize-none focus:outline-none focus:border-rose-500"
                    placeholder="ä½ å¥½ ä¸–ç•Œ å­¦ä¹  æ±‰å­—"></textarea>
                
                <button onclick="loadWords()" 
                    class="mt-6 w-full bg-white text-zinc-900 hover:bg-amber-100 font-medium py-4 rounded-3xl text-lg transition-all">
                    ë‹¨ì–´ ë¡œë“œí•˜ê¸°
                </button>

                <!-- ë‹¨ì–´ ëª©ë¡ -->
                <div class="mt-10">
                    <div class="flex items-center justify-between text-xs uppercase tracking-widest text-zinc-500 mb-3">
                        <span>ë‹¨ì–´ ëª©ë¡</span>
                        <span id="word-count">0</span>
                    </div>
                    <div id="word-list" class="space-y-1 max-h-96 overflow-auto"></div>
                </div>

                <!-- ì˜µì…˜ í† ê¸€ -->
                <div class="mt-12">
                    <div class="text-xs uppercase tracking-widest text-zinc-500 mb-4">í•™ìŠµ ë‹¨ê³„ í™œì„±í™”</div>
                    <div class="space-y-5">
                        <label class="flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" id="toggle-1" checked onchange="updateToggles()" class="w-5 h-5 accent-rose-500">
                            <span class="text-zinc-300">1. ì¼ë°˜ ë³´ê¸°</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" id="toggle-2" checked onchange="updateToggles()" class="w-5 h-5 accent-rose-500">
                            <span class="text-zinc-300">2. ë¶€ìˆ˜ ë³´ê¸°</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" id="toggle-3" checked onchange="updateToggles()" class="w-5 h-5 accent-rose-500">
                            <span class="text-zinc-300">3. íšìˆœ ë³´ê¸° (5ë°°ì†Â·ë¬´í•œë£¨í”„)</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" id="toggle-4" checked onchange="updateToggles()" class="w-5 h-5 accent-rose-500">
                            <span class="text-zinc-300">4. ìŠ¤íŠ¸ë¡œí¬ íŒ¬ë‹</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" id="toggle-5" checked onchange="updateToggles()" class="w-5 h-5 accent-rose-500">
                            <span class="text-zinc-300">5. ì¼ë°˜ í€´ì¦ˆ (ìë™ ì§„í–‰)</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" id="toggle-6" checked onchange="updateToggles()" class="w-5 h-5 accent-rose-500">
                            <span class="text-zinc-300">6. ê³ ê¸‰ í€´ì¦ˆ (ì•„ì›ƒë¼ì¸ ìˆ¨ê¹€)</span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="p-6 border-t border-zinc-800 text-xs text-zinc-500 text-center">
                Powered by HanziWriter â€¢ ì •ì  ì›¹ì‚¬ì´íŠ¸
            </div>
        </div>

        <!-- ë©”ì¸ ì˜ì—­ -->
        <div class="flex-1 flex flex-col">
            <!-- ìƒë‹¨ í”„ë¡œê·¸ë ˆìŠ¤ -->
            <div class="h-20 border-b border-zinc-800 flex items-center px-12">
                <div class="flex-1">
                    <div class="flex items-center gap-8">
                        <button onclick="prevWord()" 
                            class="px-6 py-3 text-sm font-medium flex items-center gap-2 hover:bg-zinc-800 rounded-3xl transition-colors">
                            â† ì´ì „ ë‹¨ì–´
                        </button>
                        <div class="text-center">
                            <div id="progress-word" class="text-2xl font-medium hanzi-font">1 / 1</div>
                            <div id="current-word-display" class="text-4xl hanzi-font text-amber-300 vertical-rl h-12 inline-block"></div>
                        </div>
                        <button onclick="nextWord()" 
                            class="px-6 py-3 text-sm font-medium flex items-center gap-2 hover:bg-zinc-800 rounded-3xl transition-colors">
                            ë‹¤ìŒ ë‹¨ì–´ â†’
                        </button>
                    </div>
                </div>
                
                <div class="flex items-center gap-6">
                    <div onclick="prevStage()" 
                        class="cursor-pointer w-11 h-11 flex items-center justify-center text-3xl hover:bg-zinc-800 rounded-2xl transition-colors">â€¹</div>
                    <div class="text-center w-48">
                        <div id="stage-number" class="text-4xl font-bold text-rose-400">1</div>
                        <div id="stage-name" class="text-sm uppercase tracking-widest text-zinc-400">ì¼ë°˜ ë³´ê¸°</div>
                    </div>
                    <div onclick="nextStage()" 
                        class="cursor-pointer w-11 h-11 flex items-center justify-center text-3xl hover:bg-zinc-800 rounded-2xl transition-colors">â€º</div>
                </div>
            </div>

            <!-- í•™ìŠµ ì½˜í…ì¸  -->
            <div class="flex-1 p-12 overflow-auto" id="main-content">
                <div class="max-w-5xl mx-auto">
                    <!-- ë‹¨ê³„ ì œëª© (ì„¸ë¡œ) -->
                    <div class="flex justify-between items-start">
                        <div id="stage-title" 
                            class="stage-title vertical-rl h-96 flex items-center pr-8 border-r border-zinc-700"></div>
                        
                        <!-- ì½˜í…ì¸  ì˜ì—­ -->
                        <div class="flex-1 pl-16" id="stage-content">
                            <!-- JSë¡œ ë™ì  ìƒì„± -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- í•˜ë‹¨ ì»¨íŠ¸ë¡¤ -->
            <div class="h-24 border-t border-zinc-800 bg-zinc-900 flex items-center px-12">
                <button onclick="startCurrentStage()" 
                    id="action-btn"
                    class="ml-auto px-10 py-5 bg-rose-500 hover:bg-rose-600 rounded-3xl text-xl font-medium transition-all flex items-center gap-3">
                    <span id="btn-text">ë‹¨ê³„ ì‹œì‘í•˜ê¸°</span>
                    <span class="text-2xl">â–¶</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let words = [];
        let currentWordIdx = 0;
        let currentStageIdx = 0; // enabledStages ë‚´ ì¸ë±ìŠ¤
        let enabledStages = [1,2,3,4,5,6];
        let writers = [];
        let currentWord = "";
        let animationTimer = null;
        let isQuizzing = false;

        // Tailwind ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
        function initTailwind() {
            tailwind.config = {
                content: [],
                theme: {
                    extend: {}
                }
            }
        }

        // ë‹¨ì–´ ë¡œë“œ
        function loadWords() {
            const text = document.getElementById('input-text').value.trim();
            if (!text) return alert("í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            words = text.split(/\s+/).filter(w => w.length > 0);
            renderWordList();
            if (words.length > 0) {
                currentWordIdx = 0;
                currentStageIdx = 0;
                loadCurrentWord();
            }
        }

        function renderWordList() {
            const container = document.getElementById('word-list');
            container.innerHTML = '';
            document.getElementById('word-count').textContent = words.length;
            
            words.forEach((word, i) => {
                const div = document.createElement('div');
                div.className = `px-5 py-4 rounded-3xl cursor-pointer transition-all text-lg hanzi-font ${i === currentWordIdx ? 'bg-rose-500 text-white' : 'hover:bg-zinc-800'}`;
                div.textContent = word;
                div.onclick = () => {
                    currentWordIdx = i;
                    currentStageIdx = 0;
                    renderWordList();
                    loadCurrentWord();
                };
                container.appendChild(div);
            });
        }

        function updateToggles() {
            enabledStages = [];
            if (document.getElementById('toggle-1').checked) enabledStages.push(1);
            if (document.getElementById('toggle-2').checked) enabledStages.push(2);
            if (document.getElementById('toggle-3').checked) enabledStages.push(3);
            if (document.getElementById('toggle-4').checked) enabledStages.push(4);
            if (document.getElementById('toggle-5').checked) enabledStages.push(5);
            if (document.getElementById('toggle-6').checked) enabledStages.push(6);
            
            // í˜„ì¬ ë‹¨ê³„ê°€ ìœ íš¨í•œì§€ í™•ì¸
            if (enabledStages.length === 0) return;
            if (currentStageIdx >= enabledStages.length) currentStageIdx = 0;
            updateProgress();
        }

        function loadCurrentWord() {
            if (words.length === 0) return;
            currentWord = words[currentWordIdx];
            renderWordList();
            updateProgress();
            writers = [];
            document.getElementById('stage-content').innerHTML = `
                <div id="char-container" class="char-container mx-auto"></div>
            `;
            const container = document.getElementById('char-container');
            const chars = [...currentWord];
            
            chars.forEach(ch => {
                const wrapper = document.createElement('div');
                wrapper.className = 'writer-wrapper';
                const div = document.createElement('div');
                div.style.width = '220px';
                div.style.height = '220px';
                wrapper.appendChild(div);
                container.appendChild(wrapper);
                
                const writer = HanziWriter.create(div, ch, {
                    width: 200,
                    height: 200,
                    padding: 15,
                    strokeColor: '#e0f2fe',
                    radicalColor: '#fb7185',
                    outlineColor: '#334155',
                    drawingColor: '#67e8f9',
                    strokeAnimationSpeed: 1.8,
                    delayBetweenStrokes: 180,
                    showOutline: true,
                    showCharacter: true,
                    renderer: 'svg'
                });
                writers.push(writer);
            });
            
            // ì²« ë‹¨ê³„ ë¡œë“œ
            enterCurrentStage();
        }

        function updateProgress() {
            document.getElementById('progress-word').textContent = `${currentWordIdx + 1} / ${words.length}`;
            document.getElementById('current-word-display').innerHTML = currentWord || 'â€”';
        }

        function getCurrentStage() {
            return enabledStages[currentStageIdx] || 1;
        }

        function updateStageUI() {
            const stage = getCurrentStage();
            let name = '';
            let title = '';
            switch(stage) {
                case 1: name = 'ì¼ë°˜ ë³´ê¸°'; title = 'ì¼ë°˜'; break;
                case 2: name = 'ë¶€ìˆ˜ ë³´ê¸°'; title = 'éƒ¨é¦–'; break;
                case 3: name = 'íšìˆœ ë³´ê¸°'; title = 'ç­†é †'; break;
                case 4: name = 'ìŠ¤íŠ¸ë¡œí¬ íŒ¬ë‹'; title = 'æ•£é–‹'; break;
                case 5: name = 'ì¼ë°˜ í€´ì¦ˆ'; title = 'ç·´ç¿’'; break;
                case 6: name = 'ê³ ê¸‰ í€´ì¦ˆ'; title = 'æŒ‘æˆ°'; break;
            }
            document.getElementById('stage-number').textContent = enabledStages.indexOf(stage) + 1;
            document.getElementById('stage-name').textContent = name;
            document.getElementById('stage-title').innerHTML = title;
        }

        function enterCurrentStage() {
            if (writers.length === 0) return;
            updateStageUI();
            const content = document.getElementById('stage-content');
            const stage = getCurrentStage();
            
            // ì´ì „ ì• ë‹ˆë©”ì´ì…˜/í€´ì¦ˆ ì •ë¦¬
            clearInterval(animationTimer);
            writers.forEach(w => {
                w.pauseAnimation();
                w.cancelQuiz();
            });
            isQuizzing = false;

            // ê³µí†µ ì´ˆê¸°í™”
            writers.forEach(w => {
                w.showCharacter();
                w.showOutline();
                w.updateColor('radicalColor', '#fb7185');
            });

            switch(stage) {
                case 1: // ì¼ë°˜ ë³´ê¸°
                    document.getElementById('btn-text').textContent = 'ì „ì²´ ì• ë‹ˆë©”ì´ì…˜';
                    break;
                    
                case 2: // ë¶€ìˆ˜ ë³´ê¸°
                    writers.forEach(w => w.updateColor('radicalColor', '#f43f5e'));
                    document.getElementById('btn-text').textContent = 'ë¶€ìˆ˜ ê°•ì¡° ì• ë‹ˆë©”ì´ì…˜';
                    break;
                    
                case 3: // íšìˆœ ë³´ê¸° (5ë°°ì†, chaining, ë¬´í•œë£¨í”„, buttonless)
                    document.getElementById('btn-text').textContent = 'ë¬´í•œ ë£¨í”„ ì‹œì‘';
                    break;
                    
                case 4: // ìŠ¤íŠ¸ë¡œí¬ íŒ¬ë‹
                    renderFanning();
                    document.getElementById('btn-text').textContent = 'ë‹¤ì‹œ ê·¸ë¦¬ê¸°';
                    break;
                    
                case 5: // ì¼ë°˜ í€´ì¦ˆ (buttonless, ìë™ ë‹¤ìŒ ê¸€ì)
                    document.getElementById('btn-text').textContent = 'í€´ì¦ˆ ì‹œì‘ (ìë™ ì§„í–‰)';
                    break;
                    
                case 6: // ê³ ê¸‰ í€´ì¦ˆ
                    renderAdvancedQuiz();
                    document.getElementById('btn-text').textContent = 'ê³ ê¸‰ í€´ì¦ˆ ì‹œì‘';
                    break;
            }
        }

        function startCurrentStage() {
            const stage = getCurrentStage();
            switch(stage) {
                case 1:
                    animateAllOnce(1.0);
                    break;
                case 2:
                    animateAllOnce(1.0);
                    break;
                case 3:
                    startInfiniteChainedAnimation();
                    break;
                case 4:
                    renderFanning();
                    break;
                case 5:
                    startSequentialQuiz(false);
                    break;
                case 6:
                    startSequentialQuiz(true);
                    break;
            }
        }

        function animateAllOnce(speed) {
            let i = 0;
            const next = () => {
                if (i >= writers.length) return;
                writers[i].animateCharacter({
                    strokeAnimationSpeed: speed,
                    onComplete: () => { i++; next(); }
                });
            };
            next();
        }

        function startInfiniteChainedAnimation() {
            let i = 0;
            const loop = () => {
                if (i >= writers.length) {
                    animationTimer = setTimeout(() => { i = 0; loop(); }, 1800);
                    return;
                }
                writers[i].animateCharacter({
                    strokeAnimationSpeed: 5,
                    onComplete: () => { i++; loop(); }
                });
            };
            loop();
            // ë²„íŠ¼less ëŠë‚Œ ìœ ì§€ â†’ ì™„ë£Œ ë²„íŠ¼ì€ ë³„ë„ ì—†ìŒ, ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™ ê°€ëŠ¥
        }

        // ìŠ¤íŠ¸ë¡œí¬ íŒ¬ë‹ (raw SVG ì‚¬ìš©)
        function renderFanning() {
            const container = document.getElementById('char-container');
            container.innerHTML = '';
            
            writers.forEach((writer, idx) => {
                const ch = [...currentWord][idx];
                const wrapper = document.createElement('div');
                wrapper.className = 'writer-wrapper w-[380px]';
                
                HanziWriter.loadCharacterData(ch).then(data => {
                    const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
                    svg.setAttribute("width", "360");
                    svg.setAttribute("height", "240");
                    svg.setAttribute("viewBox", "0 0 1200 1024");
                    
                    const num = data.strokes.length;
                    const offset = Math.max(55, 680 / Math.max(1, num - 1));
                    
                    data.strokes.forEach((pathData, i) => {
                        const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
                        const tx = 180 + (i - (num-1)/2) * offset;
                        g.setAttribute("transform", `translate(${tx} 80) scale(0.85)`);
                        
                        const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                        path.setAttribute("d", pathData);
                        path.setAttribute("fill", "none");
                        path.setAttribute("stroke", i % 2 === 0 ? "#67e8f9" : "#f472b6");
                        path.setAttribute("stroke-width", "22");
                        path.setAttribute("stroke-linecap", "round");
                        path.setAttribute("stroke-linejoin", "round");
                        g.appendChild(path);
                        svg.appendChild(g);
                    });
                    
                    wrapper.appendChild(svg);
                    container.appendChild(wrapper);
                });
            });
        }

        function startSequentialQuiz(advanced) {
            isQuizzing = true;
            let charIdx = 0;
            
            const startNextQuiz = () => {
                if (charIdx >= writers.length) {
                    isQuizzing = false;
                    alert("ğŸ‰ ë‹¨ì–´ í€´ì¦ˆ ì™„ë£Œ! ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™í•˜ì„¸ìš”.");
                    return;
                }
                
                const w = writers[charIdx];
                w.hideCharacter();
                if (advanced) {
                    w.hideOutline();
                    // ì¢Œìš° ë ˆì´ì•„ì›ƒì€ ì´ë¯¸ renderAdvancedQuizì—ì„œ ì²˜ë¦¬
                } else {
                    w.showOutline();
                }
                
                w.quiz({
                    onComplete: (data) => {
                        w.showCharacter();
                        charIdx++;
                        setTimeout(startNextQuiz, 800);
                    },
                    leniency: 0.85,
                    showHintAfterMisses: 2
                });
            };
            
            if (advanced) {
                renderAdvancedQuiz();
            }
            startNextQuiz();
        }

        function renderAdvancedQuiz() {
            const content = document.getElementById('stage-content');
            content.innerHTML = `
                <div class="grid grid-cols-2 gap-12">
                    <!-- ì™¼ìª½: í€´ì¦ˆ ì˜ì—­ -->
                    <div>
                        <div class="text-rose-400 text-sm mb-4 tracking-widest">ì¢Œì¸¡ â€” ì§ì ‘ ì“°ê¸° (ì•„ì›ƒë¼ì¸ ì—†ìŒ)</div>
                        <div id="quiz-left" class="char-container mx-auto"></div>
                    </div>
                    <!-- ì˜¤ë¥¸ìª½: ì°¸ì¡° ë‹¨ì–´ -->
                    <div>
                        <div class="text-rose-400 text-sm mb-4 tracking-widest">ìš°ì¸¡ â€” ì°¸ì¡° í•œì</div>
                        <div class="bg-zinc-900 rounded-3xl p-12 flex items-center justify-center min-h-[520px]">
                            <div id="reference-word" 
                                class="text-[9rem] leading-none hanzi-font text-amber-300 vertical-rl text-center tracking-widest">
                                ${currentWord}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // ì™¼ìª½ì— ìƒˆ writer ìƒì„± (ì•„ì›ƒë¼ì¸ ìˆ¨ê¹€)
            const leftContainer = document.getElementById('quiz-left');
            leftContainer.innerHTML = '';
            const chars = [...currentWord];
            
            writers = []; // ì¬ìƒì„±
            chars.forEach(ch => {
                const wrapper = document.createElement('div');
                wrapper.className = 'writer-wrapper';
                const div = document.createElement('div');
                div.style.width = '210px';
                div.style.height = '210px';
                wrapper.appendChild(div);
                leftContainer.appendChild(wrapper);
                
                const w = HanziWriter.create(div, ch, {
                    width: 190,
                    height: 190,
                    padding: 12,
                    showOutline: false,
                    showCharacter: false,
                    strokeColor: '#67e8f9',
                    drawingColor: '#a5f3fc'
                });
                writers.push(w);
            });
        }

        function prevWord() {
            if (currentWordIdx > 0) {
                currentWordIdx--;
                currentStageIdx = 0;
                loadCurrentWord();
            }
        }
        
        function nextWord() {
            if (currentWordIdx < words.length - 1) {
                currentWordIdx++;
                currentStageIdx = 0;
                loadCurrentWord();
            }
        }
        
        function prevStage() {
            if (currentStageIdx > 0) {
                currentStageIdx--;
                enterCurrentStage();
            }
        }
        
        function nextStage() {
            if (currentStageIdx < enabledStages.length - 1) {
                currentStageIdx++;
                enterCurrentStage();
            } else if (currentWordIdx < words.length - 1) {
                currentWordIdx++;
                currentStageIdx = 0;
                loadCurrentWord();
            }
        }

        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
        document.addEventListener('keydown', e => {
            if (e.key === "ArrowRight") nextStage();
            if (e.key === "ArrowLeft") prevStage();
            if (e.key === "ArrowDown") nextWord();
            if (e.key === "ArrowUp") prevWord();
        });

        // ì´ˆê¸°í™”
        window.onload = () => {
            initTailwind();
            // ë°ëª¨ í…ìŠ¤íŠ¸ ìë™ ì…ë ¥
            document.getElementById('input-text').value = "ä½ å¥½ ä¸–ç•Œ æ¼¢å­— å­¸ç¿’ ç·´ç¿’";
            loadWords();
            
            // ì²« ë‹¨ê³„ UI
            updateStageUI();
        };
    </script>
</body>
</html>
